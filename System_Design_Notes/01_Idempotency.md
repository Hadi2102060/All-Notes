
# Idempotency 

### Idempotency কী? 

**ইডেম্পোটেন্সি (Idempotency)**  হলো এমন একটি ধারণা যেখানে একই অপারেশন বা কাজ বারবার করলেও ফলাফল একই থাকে। মানে, তুমি যদি একটা কাজ একবার করো বা একশোবার করো, শেষ ফলাফল একই হবে, এবং কোনো অতিরিক্ত পার্শ্বপ্রতিক্রিয়া (side effect) হবে না।!



## উদাহরণ :

ধরো, তুমি একটা লিফটের বোতামে চাপ দিলে। তুমি যদি একবার "3 নম্বর তলা" বোতামে চাপ দাও, লিফট 3 নম্বর তলায় যাবে। এখন তুমি যদি ১০০ বার ওই বোতাম চাপো, তবুও লিফট শুধু 3 নম্বর তলায় যাবে, এর বেশি কিছু হবে না। এটা ইডেম্পোটেন্ট, কারণ বারবার একই কাজ করলেও ফলাফল একই।


<img src="image.png" alt="My Image" width="300"/>



### Idempotency  ইতিহাস

**Idempotency**  ধারণাটি এসেছে গণিত এবং কম্পিউটার বিজ্ঞান থেকে। এর শিকড় গণিতের ফাংশন এবং অপারেশনের মধ্যে পাওয়া যায়।

#### গণিতে উৎপত্তি:

- গণিতে, **Idempotent**   ফাংশন বলতে এমন ফাংশন বোঝায় যেটা বারবার প্রয়োগ করলেও ফলাফল একই থাকে। উদাহরণস্বরূপ, ধরো একটা ফাংশন f(x) = |x| (অ্যাবসলুট ভ্যালু ফাংশন)। তুমি যদি f(f(x)) করো, তাহলেও ফলাফল |x|। এটা ইডেম্পোটেন্ট।
কম্পিউটার বিজ্ঞানে প্রবেশ:

- ১৯৭০-এর দশকে, যখন ডিস্ট্রিবিউটেড সিস্টেম এবং নেটওয়ার্কিং শুরু হয়, তখন ইডেম্পোটেন্সি একটা গুরুত্বপূর্ণ ধারণা হয়ে ওঠে। বিশেষ করে, ```HTTP প্রোটোকল``` (যেটা ওয়েবে ব্যবহৃত হয়) এবং ```API ডিজাইনে``` এটা খুব জনপ্রিয় হয়। HTTP-তে কিছু মেথড (যেমন GET, PUT, DELETE) ইডেম্পোটেন্ট হিসেবে ডিজাইন করা হয়েছে।

- **আধুনিক ব্যবহার:** 

আজকাল ইডেম্পোটেন্সি ```ক্লাউড কম্পিউটিং```, ```API ডিজাইন```, ```ডাটাবেস অপারেশন```, এবং ```ডিস্ট্রিবিউটেড সিস্টেমে``` ব্যবহৃত হয়। এটা নিশ্চিত করে যে সিস্টেম নির্ভরযোগ্য এবং ত্রুটি-মুক্ত থাকে, বিশেষ করে যখন নেটওয়ার্ক ব্যর্থতা বা রিট্রাই ঘটে।
ইডেম্পোটেন্সি কেন গুরুত্বপূর্ণ?
ইডেম্পোটেন্সি গুরুত্বপূর্ণ কারণ এটা সিস্টেমকে নির্ভরযোগ্য এবং পুনরাবৃত্তিযু cornযোগ্য করে। নিচে কিছু কারণ দেওয়া হলো:

-  **নেটওয়ার্ক ব্যর্থতা মোকাবেলা:**

ধরো, তুমি একটা অনলাইন পেমেন্ট করছো। তুমি "PAY" বোতামে ক্লিক করলে, কিন্তু নেটওয়ার্ক সমস্যার কারণে সার্ভারে রিকোয়েস্ট পৌঁছায় কিনা তুমি নিশ্চিত নও। তুমি আবার ক্লিক করলে, ইডেম্পোটেন্ট অপারেশন নিশ্চিত করবে যে তোমার পেমেন্ট শুধু একবারই প্রসেস হবে, বারবার ক্লিক করলেও।

- **ডাটাবেস স্থিতিশীলতা:**

ডাটাবেসে যদি একই কোয়েরি বারবার চলে, ইডেম্পোটেন্সি নিশ্চিত করে যে ডাটা দূষিত বা ভুল হবে না।

- **API ডিজাইন:**

RESTful API-তে ইডেম্পোটেন্সি খুব গুরুত্বপূর্ণ। উদাহরণস্বরূপ, HTTP PUT মেথড ইডেম্পোটেন্ট, মানে একই রিকোয়েস্ট বারবার পাঠালেও রিসোর্সের অবস্থা একই থাকবে।


### ইডেম্পোটেন্সি কোথায় ব্যবহৃত হয়?

ইডেম্পোটেন্সির ব্যবহার বিভিন্ন জায়গায় দেখা যায়। এখানে কিছু উদাহরণ:

##### HTTP মেথডস:

**GET:** কোনো রিসোর্স পড়ার জন্য ব্যবহৃত হয়। বারবার GET রিকোয়েস্ট পাঠালেও ফলাফল একই থাকে, কোনো সাইড ইফেক্ট হয় না।
**PUT:**  কোনো রিসোর্স আপডেট করার জন্য। একই ডাটা দিয়ে বারবার PUT করলে রিসোর্স একই থাকে।
**DELETE:** কোনো রিসোর্স মুছে ফেলার জন্য। একই রিসোর্স বারবার মুছতে চাইলে, প্রথমবার মুছে ফেলার পর আর কোনো প্রভাব থাকে না।
নন-ইডেম্পোটেন্ট মেথড:

**POST:** নতুন রিসোর্স তৈরি করে। বারবার POST করলে নতুন নতুন রিসোর্স তৈরি হতে পারে, তাই এটা ইডেম্পোটেন্ট নয়।
ডাটাবেস অপারেশন:

**Example:** 

ধরো, তুমি একটা ডাটাবেসে UPDATE users SET status = 'active' WHERE user_id = 123 কোয়েরি চালালে। এটা ইডেম্পোটেন্ট, কারণ বারবার চালালেও status শুধু activeই থাকবে।


- **ক্লাউড সিস্টেম:**

ক্লাউডে রিসোর্স তৈরির সময় ইডেম্পোটেন্সি নিশ্চিত করে যে একই রিসোর্স বারবার তৈরি না হয়। উদাহরণস্বরূপ, AWS-এর API গুলো ইডেম্পোটেন্সি সাপোর্ট করে।


#### ইডেম্পোটেন্সি কীভাবে বাস্তবায়ন করবো?

ইডেম্পোটেন্সি বাস্তবায়ন করতে হলে কিছু কৌশল ব্যবহার করতে হয়। এখানে কিছু পদ্ধতি:

- **ইডেম্পোটেন্সি কী (Idempotency Key):**

এটা একটা ইউনিক আইডি যা প্রতিটি রিকোয়েস্টের সাথে পাঠানো হয়। সার্ভার এই কী ব্যবহার করে চেক করে যে এই রিকোয়েস্ট আগে প্রসেস করা হয়েছে কিনা।

```উদাহরণ:```

তুমি একটা পেমেন্ট API-তে রিকোয়েস্ট পাঠালে, তুমি একটা ইউনিক idempotency_key পাঠাবে। সার্ভার চেক করবে এই কী দিয়ে আগে কোনো পেমেন্ট প্রসেস হয়েছে কিনা। যদি হয়ে থাকে, তাহলে আবার প্রসেস করবে না, শুধু আগের ফলাফল ফেরত দেবে।


- **ডাটাবেস ডিজাইন:**

ডাটাবেসে ইডেম্পোটেন্ট অপারেশন নিশ্চিত করতে ইউনিক কনস্ট্রেইন্ট বা চেক ব্যবহার করা যায়। উদাহরণস্বরূপ, একটা ট্রানজ্যাকশন টেবিলে ইউনিক transaction_id রাখা।


- **স্টেট চেকিং:**

সার্ভারে অপারেশন করার আগে স্টেট চেক করা। যেমন, DELETE রিকোয়েস্টের আগে চেক করা যে রিসোর্স আদৌ আছে কিনা।
ইডেম্পোটেন্সি ব্যবহারের বাস্তব উদাহরণ (কোড সহ)
ধরো, তুমি একটা REST API তৈরি করছো, যেখানে একজন ইউজারের স্ট্যাটাস আপডেট করতে হবে। আমরা এটা ইডেম্পোটেন্ট করবো।

###### কোড (Node.js + Express):

```
const express = require('express');
const app = express();
app.use(express.json());

// ইউজার ডাটাবেস (সিম্পল অবজেক্ট হিসেবে)
const users = {};

// ইডেম্পোটেন্সি কী স্টোর
const idempotencyKeys = new Set();

app.put('/users/:id/status', (req, res) => {
  const userId = req.params.id;
  const { status, idempotencyKey } = req.body;

  // ইডেম্পোটেন্সি কী চেক
  if (idempotencyKeys.has(idempotencyKey)) {
    // আগে প্রসেস করা হয়েছে, আগের ফলাফল ফেরত দাও
    return res.status(200).json({ userId, status: users[userId]?.status });
  }

  // নতুন কী স্টোর করো
  idempotencyKeys.add(idempotencyKey);

  // ইউজার স্ট্যাটাস আপডেট
  users[userId] = { status };
  res.status(200).json({ userId, status });
});

app.listen(3000, () => console.log('Server running on port 3000'));


```

**ব্যাখ্যা:**


- ক্লায়েন্ট একটা idempotencyKey পাঠাবে প্রতিটি রিকোয়েস্টের সাথে।

- সার্ভার চেক করবে এই কী আগে ব্যবহার হয়েছে কিনা।

- যদি হয়ে থাকে, তাহলে আগের ফলাফল ফেরত দেবে।

- যদি না হয়ে থাকে, তাহলে নতুন করে স্ট্যাটাস আপডেট করবে এবং কী স্টোর করবে।

```উদাহরণ রিকোয়েস্ট:```

```
curl -X PUT http://localhost:3000/users/123/status \
-H "Content-Type: application/json" \
-d '{"status": "active", "idempotencyKey": "abc123"}'

```

এই রিকোয়েস্ট বারবার পাঠালেও ইউজারের স্ট্যাটাস শুধু একবারই আপডেট হবে।